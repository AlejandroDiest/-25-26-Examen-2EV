<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head}"></head>
<body class="d-flex flex-column min-vh-100">

<nav th:replace="~{fragments/navbar :: navbar}"></nav>

<main class="container flex-grow-1">
    <div th:replace="~{fragments/messages :: messages}"></div>

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1><i class="bi me-2"></i>Listado de Habilidades</h1>
        <a th:href="@{/habilidades/nuevo}" class="btn btn-primary">
            <i class="bi bi-plus-circle-fill me-1"></i>Nuevo habilidad
        </a>
    </div>

    <div class="card shadow-sm">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-striped table-hover mb-0">
                    <thead class="table-dark">
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Nombre</th>
                            <th scope="col">Descripcion</th>
                            <th scope="col">Dificultad</th>
                            <th scope="col">Experiencia</th>
                            <th scope="col">Categoria</th>
                            <th scope="col" class="text-center" style="width: 150px;">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="habilidad : ${habilidades}">
                            <td th:text="${habilidad.id}"></td>
                            <td th:text="${habilidad.nombre}"></td>
                            <td th:text="${habilidad.descripcion}"></td>
                            <td th:text="${habilidad.dificultad}"></td>
                            <td th:text="${habilidad.experiencia}"></td>
                            <td th:text="${habilidad.categoria}"></td>                   
                            <td class="text-center">
                                
                                <button type="button" class="btn btn-sm btn-danger btn-eliminar"
                                        th:title="'Eliminar ' + ${habilidad.nombre}"
                                        th:data-url="@{/habilidades/{id}/eliminar(id=${habilidad.id})}"
                                        th:data-nombre="${habilidad.nombre}">
                                    <i class="bi bi-trash-fill"></i>
                                </button>
                            </td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(habilidades)}">
                            <td colspan="12" class="text-center text-muted py-4">
                                <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                                No hay habilidades registrados
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</main>

<!-- Modal de confirmacion para eliminar -->
<div class="modal fade" id="modalConfirmarEliminar" tabindex="-1" aria-labelledby="modalConfirmarEliminarLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="modalConfirmarEliminarLabel">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i>Confirmar eliminacion
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                <p id="mensajeConfirmacion">¿Esta seguro de que desea eliminar este habilidad	?</p>
                <p class="text-muted small">Esta accion no se puede deshacer.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-lg me-1"></i>Cancelar
                </button>
                <form id="formEliminar" method="post" style="display: inline;">
                    <button type="submit" class="btn btn-danger">
                        <i class="bi bi-trash-fill me-1"></i>Eliminar
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<footer th:replace="~{fragments/footer :: footer}"></footer>

<div th:replace="~{fragments/scripts :: scripts}"></div>

<script>
    // Event listeners para botones de eliminar
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.btn-eliminar').forEach(function(btn) {
            btn.addEventListener('click', function() {
                var url = this.getAttribute('data-url');
                var nombre = this.getAttribute('data-nombre');
                document.getElementById('formEliminar').action = url;
                document.getElementById('mensajeConfirmacion').innerHTML =
                    '¿Esta seguro de que desea eliminar a <strong>' + nombre + '</strong>?';
                var modal = new bootstrap.Modal(document.getElementById('modalConfirmarEliminar'));
                modal.show();
            });
        });
    });
</script>
</body>
</html>
