<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head}"></head>
<body class="d-flex flex-column min-vh-100">

<nav th:replace="~{fragments/navbar :: navbar}"></nav>

<main class="container flex-grow-1">
    <div th:replace="~{fragments/messages :: messages}"></div>

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1><i class="bi me-2"></i>Listado de Naufragos</h1>
        <a th:href="@{/naufragos/nuevo}" class="btn btn-primary">
            <i class="bi bi-plus-circle-fill me-1"></i>Nuevo naufrago
        </a>
    </div>

    <div class="card shadow-sm">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-striped table-hover mb-0">
                    <thead class="table-dark">
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Nombre</th>
                            <th scope="col">Edad</th>
                            <th scope="col">Sexo</th>
                            <th scope="col">Isla</th>
                            <th scope="col">Nacionalidad</th>
                            <th scope="col">Fecha Rescate</th>
                            <th scope="col">Habilidad</th>
                            <th scope="col" class="text-center" style="width: 150px;">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="naufrago : ${naufragos}">
                            <td th:text="${naufrago.id}"></td>
                            <td th:text="${naufrago.nombre}"></td>
                            <td th:text="${naufrago.edad}"></td>
                            <td><span class="badge bg-secondary" th:text="${naufrago.sexo}"></span></td>
                            <td th:text="${naufrago.isla}"></td>
                            <td th:text="${naufrago.nacionalidad}"></td>
                            <td th:text="${naufrago.fecha_rescate}"></td>
                            <td th:text="${naufrago.habilidad}"></td>                    
                            <td class="text-center">
                                
                                <button type="button" class="btn btn-sm btn-danger btn-eliminar"
                                        th:title="'Eliminar ' + ${naufrago.nombre}"
                                        th:data-url="@{/naufragos/{id}/eliminar(id=${naufrago.id})}"
                                        th:data-nombre="${naufrago.nombre}">
                                    <i class="bi bi-trash-fill"></i>
                                </button>
                            </td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(naufragos)}">
                            <td colspan="12" class="text-center text-muted py-4">
                                <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                                No hay naufragos registrados
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</main>

<!-- Modal de confirmacion para eliminar -->
<div class="modal fade" id="modalConfirmarEliminar" tabindex="-1" aria-labelledby="modalConfirmarEliminarLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="modalConfirmarEliminarLabel">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i>Confirmar eliminacion
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                <p id="mensajeConfirmacion">¿Esta seguro de que desea eliminar este naufrago	?</p>
                <p class="text-muted small">Esta accion no se puede deshacer.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-lg me-1"></i>Cancelar
                </button>
                <form id="formEliminar" method="post" style="display: inline;">
                    <button type="submit" class="btn btn-danger">
                        <i class="bi bi-trash-fill me-1"></i>Eliminar
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<footer th:replace="~{fragments/footer :: footer}"></footer>

<div th:replace="~{fragments/scripts :: scripts}"></div>

<script>
    // Event listeners para botones de eliminar
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.btn-eliminar').forEach(function(btn) {
            btn.addEventListener('click', function() {
                var url = this.getAttribute('data-url');
                var nombre = this.getAttribute('data-nombre');
                document.getElementById('formEliminar').action = url;
                document.getElementById('mensajeConfirmacion').innerHTML =
                    '¿Esta seguro de que desea eliminar a <strong>' + nombre + '</strong>?';
                var modal = new bootstrap.Modal(document.getElementById('modalConfirmarEliminar'));
                modal.show();
            });
        });
    });
</script>
</body>
</html>
